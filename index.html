<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linksaw</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
    <!-- Include Firebase SDK (version 8) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>
    <!-- <script src="./auth/firebase-config.js"></script> -->
    <!-- <script src="./auth/google-signin.js"></script> -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">
    
</head>
<body>

<script>

    // firebase-config.js

var firebaseConfig = {
    apiKey: "AIzaSyCauN-vsgUfQJXc5b41NoCnYzi6FIn86MQ",
    authDomain: "linkshare-eb70b.firebaseapp.com",
    databaseURL: "https://linkshare-eb70b-default-rtdb.firebaseio.com",
    projectId: "linkshare-eb70b",
    storageBucket: "linkshare-eb70b.appspot.com",
    messagingSenderId: "284502085616",
    appId: "1:284502085616:web:3f24e3fb844320eef85735",
    measurementId: "G-VQ0J98LXYT"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
firebase.analytics();

    

    // Initialize Google Sign-In
    const googleAuthProvider = new firebase.auth.GoogleAuthProvider();

    
</script>

<div class="column-centered">
    <h1 class="brand-home">Linksaw</h1>
    <p class="tagline">Custom shortlinks based on your Google username</p>
    
    <br>
    <!-- HTML buttons to trigger sign in and sign out -->
    <button class="button sign-in" onclick="signInWithGoogle()">Sign In with Google</button>
</div>

<script>
    var username;
function signInWithGoogle() {
    firebase.auth().signInWithPopup(googleAuthProvider)
        .then((result) => {
            // This gives you a Google Access Token.
            const token = result.credential.accessToken;
            // The signed-in user info.
            const user = result.user;
            console.log('User signed in:', user);

            // Extract the username from the email without @gmail.com
            const username = user.email.replace(/@gmail\.com$/, '');

            localStorage.setItem('username', username);

            // Check if the user already exists in the database
            const userRef = firebase.database().ref('users/' + user.uid);
            userRef.once('value')
                .then((snapshot) => {
                    if (!snapshot.exists()) {
                        // If the user doesn't exist, add them to the database
                        userRef.set({
                            displayName: user.displayName,
                            email: user.email,
                            photoURL: user.photoURL,
                            createdAt: firebase.database.ServerValue.TIMESTAMP,
                            lastLoginAt: firebase.database.ServerValue.TIMESTAMP,
                            username: username // Set the username in the database
                        });
                    } else {
                        // If the user already exists, update the lastLoginAt timestamp
                        userRef.update({ lastLoginAt: firebase.database.ServerValue.TIMESTAMP });
                    }

                    // Redirect to the dashboard upon successful login
                    window.location.href = '/links';
                })
                .catch((error) => {
                    console.error('Error checking/updating user in the database:', error);
                });
        })
        .catch((error) => {
            // Handle errors here.
            const errorCode = error.code;
            const errorMessage = error.message;
            console.error(`Google Sign-In Error: ${errorCode} - ${errorMessage}`);
        });
}

function signOut() {
    firebase.auth().signOut().then(() => {
        console.log('User signed out.');
        // Redirect to the home page after signing out
        window.location.href = '/';
    }).catch((error) => {
        console.error('Sign-out error:', error);
    });
}




</script>


</body>
</html>
